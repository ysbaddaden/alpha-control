<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
	<link rel="stylesheet" type="text/css" href="../base.css"/>
	<title>UI.Autocomplete</title>
</head>
<body>
	<h1>UI.Autocomplete</h1>
  
  <form action="#" method="get">
    <div>
      Simple search (HTML response):<br/>
      <input type="text" id="autocomplete1" placeholder="First name"/>
    </div>
  </form>
  
  <br/>
  
  <form action="#" method="get">
    <div>
      Automatically marks the first item (HTML response):<br/>
      <input type="text" id="autocomplete2" placeholder="First name"/>
    </div>
  </form>
  
  <br/>
  
  <form action="#" method="get">
    <div>
      Advanced behavior (JSON response + hidden field ID):<br/>
      <input type="text" id="user_id" placeholder="user_id" disabled="true"/><br/>
      <input type="text" id="autocomplete3" placeholder="First name"/>
    </div>
  </form>
  
  <br/>
  
  <form action="#" method="get">
    <div>
      Advanced behavior (JSONP response):<br/>
      <input type="text" id="autocomplete4" placeholder="First name"/>
    </div>
  </form>

<script src="../loader.js"></script>
<script>
load('..');
</script>

<script>
// responseText is HTML (a series of LI elements)

var simple = new UI.Autocomplete();
simple.initAutocomplete(document.getElementById('autocomplete1'), {
  url: '/search',
  param: "firstname"
});

var automark = new UI.Autocomplete();
automark.initAutocomplete(document.getElementById('autocomplete2'), {
  url: '/search',
  param: "firstname",
  autoMarkFirst: true
});

// responseText is JSON + we want to set an hidden field

var a = new UI.Autocomplete();

a.setItems = function()
{
  var names = JSON.parse(this.request.responseText),
    fragment = document.createDocumentFragment(), li;
  
  for (var i=0; i<names.length; i++)
  {
    li = document.createElement('li');
    li.setAttribute('data-id', names[i].id);
    li.innerHTML = names[i].name;
    fragment.appendChild(li);
  }
  UI.Autocomplete.prototype.setItems.call(this, fragment);
}

a.autocomplete = function(event)
{
  $('user_id').value = event.targetElement.getAttribute('data-id');
  UI.Autocomplete.prototype.setValue.call(this, event.targetElement.innerText);
}

a.initAutocomplete(document.getElementById('autocomplete3'), {
  url: '/search.json',
  param: "firstname",
  autoMarkFirst: true
});

// JSONP requests
var a4 = new UI.Autocomplete();

a4.setItems = function(json)
{
  var fragment = document.createDocumentFragment(), li;
  if (json.length)
  {
    for (var i=0; i<json.length; i++)
    {
      li = document.createElement('li');
      li.setAttribute('data-id', json[i].id);
      li.innerHTML = json[i].name;
      fragment.appendChild(li);
    }
    UI.Autocomplete.prototype.setItems.call(this, fragment);
  }
  else {
    this.clearItems();
  }
}

a4.initAutocomplete(document.getElementById('autocomplete4'), {
  url: 'http://' + window.location.host + '/search.json',
  param: "firstname",
  jsonp: true,
  callback: 'cb'
});

</script>

</body>
</html>
